SSB_QB4OLAP

1) create graphs 



INSTANCES 
SPARQL create GRAPH <http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap>;

SCHEMA 
SPARQL create GRAPH <http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap>;


2) load data into graphs

delete from DB.DBA.load_list;

2) load data
ld_dir ('data/ssb/ssb_qb4olap', 'lineorder_qb1.ttl', 'http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap');
ld_dir ('data/ssb/ssb_qb4olap', 'ssb_qb4olap_dsd.ttl', 'http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap');
ld_dir ('data/ssb/ssb_ld', 'supplier.ttl', 'http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap');
ld_dir ('data/ssb/ssb_ld', 'date.ttl', 'http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap');
ld_dir ('data/ssb/ssb_ld', 'customer.ttl', 'http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap');
ld_dir ('data/ssb/ssb_ld', 'part.ttl', 'http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap');


rdf_loader_run ();


3) Check if everything was loaded

select * from DB.DBA.load_list;



sparql select count(*) from <http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap> where {?s ?p ?o} ;
120023423


sparql select count(*) from <http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap> where {?s ?p ?o} ;
2332306

---------------------
SPARQL queries to populate QB4OLAP dimensions from SSB_LD


-----------------------------------------------------------Time dimension

-date level
LEVEL: rdfh:lo_orderdate
MEMBER URIs: ?date 
ATTRIBUTES: 
rdfh:d_daynuminweek
rdfh:d_dayofweek
rdfh:d_daynuminmonth
rdfh:d_daynuminyear.
ROLLUPS TO:
- ssb-qb4olap:week via ssb-qb4olap:dateInWeek
- ssb-qb4olap:month via ssb-qb4olap:dateInMonth

-week level
LEVEL: sb-qb4olap:week
MEMBER URIs: 
ATTRIBUTES: 
ssb-qb4olap:weekNbYear (obtained from rdfh:d_weeknuminyear)
ROLLUPS TO:
- ssb-qb4olap:month via ssb-qb4olap:weekInMonth

-month level
LEVEL: sb-qb4olap:month
MEMBER URIS: 
ATTRIBUTES: 
ssb-qb4olap:monthNbYear (obtained from rdfh:d_monthnuminyear)
ssb-qb4olap:monthName (obtained from rdfh:d_month)
ROLLUPS TO:
- ssb-qb4olap:year via ssb-qb4olap:monthInYear

-year level
LEVEL: sb-qb4olap:year
ATTRIBUTES: 
ssb-qb4olap:yearNum (obtained from rdfh:d_year)

/// sample from date.ttl
rdfh-inst:date_19920101
    a rdfh:date ;
    rdfh:d_datekey 19920101 ;
    rdfh:d_date "January 1, 1992" ;
    rdfh:d_dayofweek "Thursday" ;
    rdfh:d_month "January" ;
    rdfh:d_year 1992 ;
    rdfh:d_yearmonthnum 199201 ;
    rdfh:d_yearmonth "Jan1992" ;
    rdfh:d_daynuminweek 5 ;
    rdfh:d_daynuminmonth 1 ;
    rdfh:d_daynuminyear 1 ;
    rdfh:d_monthnuminyear 1 ;
    rdfh:d_weeknuminyear 1 ;
    rdfh:d_sellingseason "Winter" ;
    rdfh:d_lastdayinweekfl "0" ;
    rdfh:d_lastdayinmonthfl "1" ;
    rdfh:d_holidayfl "1" ;
    rdfh:d_weekdayfl "1" .


prefix rdfh: <http://lod2.eu/schemas/rdfh#> 
prefix rdfh-inst: <http://lod2.eu/schemas/rdfh-inst#>
prefix qb: <http://purl.org/linked-data/cube#> 
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
prefix skos: <http://www.w3.org/2004/02/skos/core#> 
prefix skosclass: <http://ddialliance.org/ontologies/skosclass#> 
prefix qb4o: <http://purl.org/qb4olap/cubes#> 
prefix ssb-qb4olap: <http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap#> 

INSERT INTO GRAPH <http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap> { 
?date qb4o:memberOf rdfh:lo_orderdate;
	ssb-qb4olap:dateInWeek ?week;
	ssb-qb4olap:dateInMonth ?month.

?week qb4o:memberOf ssb-qb4olap:week;
	ssb-qb4olap:weekNbYear ?d_weeknuminyear;
	ssb-qb4olap:weekInYear ?year.

?month qb4o:memberOf ssb-qb4olap:month;
	ssb-qb4olap:monthNbYear ?d_monthnuminyear;
	ssb-qb4olap:monthName ?d_month;
	ssb-qb4olap:yearmonthnum ?d_yearmonthnum;
	ssb-qb4olap:monthInYear ?year.

?year qb4o:memberOf ssb-qb4olap:year;
	ssb-qb4olap:yearNum ?d_year.

}
WHERE{
	SELECT iri (bif:concat ("http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap#week", bif:concat (str(?d_year), str(?d_weeknuminyear)))) as ?week
	iri (bif:concat ("http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap#month", str(?d_yearmonthnum))) as ?month
	iri (bif:concat ("http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap#year", str(?d_year))) as ?year 
	?date ?d_weeknuminyear ?d_monthnuminyear ?d_month ?d_year ?d_yearmonthnum
	FROM <http://lod2.eu/schemas/rdfh-inst#ssb1_ttl_qb>
	WHERE{
	?date a rdfh:date.
	  ?date rdfh:d_weeknuminyear ?d_weeknuminyear.
      ?date rdfh:d_year ?d_year.
      ?date rdfh:d_yearmonth ?d_yearmonth.
      ?date rdfh:d_yearmonthnum ?d_yearmonthnum.
      ?date rdfh:d_monthnuminyear ?d_monthnuminyear.
      ?date rdfh:d_month ?d_month.
	}
}


-----------------------------------------------------------Customer dimension
#customer level
LEVEL: rdfh:lo_custkey
MEMBER URIs: ?customer 
ATTRIBUTES: 
rdfh:c_custkey
rdfh:c_name
rdfh:c_address

ROLLUPS TO:
- ssb-qb4olap:city via ssb-qb4olap:inCity

#city level
LEVEL: ssb-qb4olap:city
MEMBER URIs:  
ATTRIBUTES: 
ssb-qb4olap:cityName

ROLLUPS TO:
- ssb-qb4olap:nation via ssb-qb4olap:inNation

#nation level
LEVEL: ssb-qb4olap:nation
MEMBER URIs:  
ATTRIBUTES: 
ssb-qb4olap:nationName

ROLLUPS TO:
- ssb-qb4olap:region via ssb-qb4olap:inRegion

#region level
LEVEL: ssb-qb4olap:region
MEMBER URIs:  
ATTRIBUTES: 
ssb-qb4olap:regionName


	prefix rdfh: <http://lod2.eu/schemas/rdfh#> 
	prefix rdfh-inst: <http://lod2.eu/schemas/rdfh-inst#>
	prefix qb: <http://purl.org/linked-data/cube#> 
	prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
	prefix skos: <http://www.w3.org/2004/02/skos/core#> 
	prefix skosclass: <http://ddialliance.org/ontologies/skosclass#> 
	prefix qb4o: <http://purl.org/qb4olap/cubes#> 
	prefix ssb-qb4olap: <http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap#> 

	INSERT INTO GRAPH <http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap> { 
	?customer qb4o:memberOf rdfh:lo_custkey;
		ssb-qb4olap:inCity ?city.

	?city qb4o:memberOf ssb-qb4olap:city;
		ssb-qb4olap:cityName ?c_city;
		ssb-qb4olap:inNation ?nation.

	?nation qb4o:memberOf ssb-qb4olap:nation;
		ssb-qb4olap:nationName ?c_nation;
		ssb-qb4olap:inRegion ?region.

	?region qb4o:memberOf ssb-qb4olap:region;
		ssb-qb4olap:regionName ?c_region.

	}
	WHERE{
		SELECT iri (bif:concat ("http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap#city", str(?c_city))) as ?city
		iri (bif:concat ("http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap#nation", str(?c_nation))) as ?nation
		iri (bif:concat ("http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap#region", str(?c_region))) as ?region 
		?customer ?c_city ?c_nation ?c_region
		FROM <http://lod2.eu/schemas/rdfh-inst#ssb1_ttl_qb>
		WHERE{
		?customer a rdfh:customer.
		?customer rdfh:c_city ?c_city.
		?customer rdfh:c_nation ?c_nation.
		?customer rdfh:c_region ?c_region.
		}
	}

sample data from customer.ttl
rdfh-inst:customer_1
    a rdfh:customer ;
    rdfh:c_custkey 1 ;
    rdfh:c_name "Customer#000000001" ;
    rdfh:c_address "j5JsirBM9P" ;
    rdfh:c_city "MOROCCO  4" ;
    rdfh:c_nation "MOROCCO" ;
    rdfh:c_region "AFRICA" ;
    rdfh:c_phone "25-214-662-5265" ;
    rdfh:c_mktsegment "BUILDING" .


-----------------------------------------------------------Supplier dimension

#supplier level
LEVEL: rdfh:lo_suppkey
MEMBER URIs: ?supplier
ATTRIBUTES: 
rdfh:s_suppkey
rdfh:s_name
rdfh:s_address

ROLLUPS TO:
- ssb-qb4olap:city via ssb-qb4olap:inCity

#city level
LEVEL: ssb-qb4olap:city
MEMBER URIs:  
ATTRIBUTES: 
ssb-qb4olap:cityName

ROLLUPS TO:
- ssb-qb4olap:nation via ssb-qb4olap:inNation

#nation level
LEVEL: ssb-qb4olap:nation
MEMBER URIs:  
ATTRIBUTES: 
ssb-qb4olap:nationName

ROLLUPS TO:
- ssb-qb4olap:region via ssb-qb4olap:inRegion

#region level
LEVEL: ssb-qb4olap:region
MEMBER URIs:  
ATTRIBUTES: 
ssb-qb4olap:regionName

sample data from supplier.ttl

rdfh-inst:supplier_1
    a rdfh:supplier ;
    rdfh:s_suppkey 1 ;
    rdfh:s_name "Supplier#000000001" ;
    rdfh:s_address "sdrGnXCDRcfriBvY0KL,i" ;
    rdfh:s_city "PERU     7" ;
    rdfh:s_nation "PERU" ;
    rdfh:s_region "AMERICA" ;
    rdfh:s_phone "27-989-741-2988" .

	prefix rdfh: <http://lod2.eu/schemas/rdfh#> 
	prefix rdfh-inst: <http://lod2.eu/schemas/rdfh-inst#>
	prefix qb: <http://purl.org/linked-data/cube#> 
	prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
	prefix skos: <http://www.w3.org/2004/02/skos/core#> 
	prefix skosclass: <http://ddialliance.org/ontologies/skosclass#> 
	prefix qb4o: <http://purl.org/qb4olap/cubes#> 
	prefix ssb-qb4olap: <http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap#> 

	INSERT INTO GRAPH <http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap> {
	?supplier qb4o:memberOf rdfh:lo_suppkey;
		ssb-qb4olap:inCity ?city.

	?city qb4o:memberOf ssb-qb4olap:city;
		ssb-qb4olap:cityName ?s_city;
		ssb-qb4olap:inNation ?nation.

	?nation qb4o:memberOf ssb-qb4olap:nation;
		ssb-qb4olap:nationName ?s_nation;
		ssb-qb4olap:inRegion ?region.

	?region qb4o:memberOf ssb-qb4olap:region;
		ssb-qb4olap:regionName ?s_region.

	}
	WHERE{
		SELECT iri (bif:concat ("http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap#city", str(?s_city))) as ?city
		iri (bif:concat ("http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap#nation", str(?s_nation))) as ?nation
		iri (bif:concat ("http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap#region", str(?s_region))) as ?region 
		?supplier ?s_city ?s_nation ?s_region
		FROM <http://lod2.eu/schemas/rdfh-inst#ssb1_ttl_qb>
		WHERE{
		?supplier a rdfh:supplier.
		?supplier rdfh:s_city ?s_city.
		?supplier rdfh:s_nation ?s_nation.
		?supplier rdfh:s_region ?s_region.
		}
	}




-----------------------------------------------------------Parts dimension

#part level
LEVEL: rdfh:lo_partkey
MEMBER URIs: ?part
ATTRIBUTES: 
rdfh:p_partkey
rdfh:p_name
rdfh:p_color.

ROLLUPS TO:
- ssb-qb4olap:brand via ssb-qb4olap:hasBrand

#brand level
LEVEL: ssb-qb4olap:brand
MEMBER URIs:  
ATTRIBUTES: 
ssb-qb4olap:brandName

ROLLUPS TO:
- ssb-qb4olap:category via ssb-qb4olap:hasCategory

#category level
LEVEL: ssb-qb4olap:category
MEMBER URIs:  
ATTRIBUTES: 
ssb-qb4olap:categoryName

ROLLUPS TO:
- ssb-qb4olap:manufacturer via ssb-qb4olap:hasManufacturer

#manufacturer level
LEVEL: ssb-qb4olap:manufacturer
MEMBER URIs:  
ATTRIBUTES: 
ssb-qb4olap:manufacturerName

prefix rdfh: <http://lod2.eu/schemas/rdfh#> 
prefix rdfh-inst: <http://lod2.eu/schemas/rdfh-inst#>
prefix qb: <http://purl.org/linked-data/cube#> 
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
prefix skos: <http://www.w3.org/2004/02/skos/core#> 
prefix skosclass: <http://ddialliance.org/ontologies/skosclass#> 
prefix qb4o: <http://purl.org/qb4olap/cubes#> 
prefix ssb-qb4olap: <http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap#> 

INSERT INTO GRAPH <http://www.fing.edu.uy/inco/cubes/schemas/ssb_qb4olap> {
?part qb4o:memberOf rdfh:lo_partkey;
	ssb-qb4olap:hasBrand ?brand.

?brand qb4o:memberOf ssb-qb4olap:brand;
	ssb-qb4olap:brandName ?p_brand1;
	ssb-qb4olap:hasCategory ?category.

?category qb4o:memberOf ssb-qb4olap:category;
	ssb-qb4olap:categoryName ?p_category;
	ssb-qb4olap:hasManufacturer ?manuf.

?manuf qb4o:memberOf ssb-qb4olap:manufacturer;
	ssb-qb4olap:manufacturerName ?p_mfgr.

}
WHERE{
	SELECT iri (bif:concat ("http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap#brand", str(?p_category))) as ?category
	iri (bif:concat ("http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap#category", str(?p_brand1))) as ?brand
	iri (bif:concat ("http://www.fing.edu.uy/inco/cubes/instances/ssb_qb4olap#manufacturer", str(?p_mfgr))) as ?manuf 
	?part ?p_category ?p_brand1 ?p_mfgr
	FROM <http://lod2.eu/schemas/rdfh-inst#ssb1_ttl_qb>
	WHERE{
	?part a rdfh:part.
	?part rdfh:p_category ?p_category.
	?part rdfh:p_brand1 ?p_brand1.
	?part rdfh:p_mfgr ?p_mfgr.
	}
}

sample data from part.ttl

rdfh-inst:part_1
    a rdfh:part ;
    rdfh:p_partkey 1 ;
    rdfh:p_name "lace spring" ;
    rdfh:p_mfgr "MFGR#1" ;
    rdfh:p_category "MFGR#11" ;
    rdfh:p_brand1 "MFGR#1121" ;
    rdfh:p_color "goldenrod" ;
    rdfh:p_type "PROMO BURNISHED COPPER" ;
    rdfh:p_size 7 ;
    rdfh:p_container "JUMBO PKG" .

